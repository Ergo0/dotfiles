!function(e){var a;e.getBackgroundInterface=(a=null,function(e){return null===a&&((e=e||{}).source=window,e.direct=!0,a=Interfaces.createInstance(Interfaces.BackgroundInterface,e)),a}),e.getUILanguage=function(){return"en-US"},e.fill=function(e){lpevent("m_mf"),fillaid(e,!0,"notrack")}}(LPPlatform),function(e,a){e.getFavicon=function(e){e.callback&&e.callback(null)},e.onAuthRequired=function(e){return!1},e.openLogin=function(){e.openTabDialog("loginSimple")},e.once=function(e,a,t){if(e)var n=e(function(){n(),a.apply(t,arguments)})},e.getBigIcons=function(e,a){var t=(a=a||"big")+"icons",n=opendb();if(createDataTable(n),n){var r=function(a,t){e(t.rows.length>0&&null!==t.rows.item(0).data?t.rows.item(0).data:"")};if(g_indexeddb){var i={rows:{item:function(e){return this[e]},length:0}};n.transaction("LastPassData","readonly").objectStore("LastPassData").openCursor(IDBKeyRange.only(db_prepend(g_username_hash)+"_"+t)).onsuccess=function(e){var a=e.target.result;a?(i.rows[i.rows.length]=a.value,i.rows.length++,a.continue()):r(0,i)}}else n.transaction(function(e){e.executeSql("SELECT * FROM LastPassData WHERE username_hash=? AND type=?",[db_prepend(g_username_hash),t],r,function(e,a){console_log(a)})})}},e.saveBigIcons=function(e,a){var t=(a=a||"big")+"icons",n=opendb();createDataTable(n),n&&(g_indexeddb?n.transaction("LastPassData","readwrite").objectStore("LastPassData").put({username_hash:db_prepend(g_username_hash),type:t,data:e,usertype:db_prepend(g_username_hash)+"_"+t}):n.transaction(function(a){a.executeSql("REPLACE INTO LastPassData (username_hash, type, data) VALUES (?, ?, ?)",[db_prepend(g_username_hash),t,e],function(e,a){console_log("server.js : inserted")},function(e,a){console_log(a)})}))},e.updateBigIcons=function(){};var t,n,r,i,o,s,c,l,f=function(e,a){for(var t in e){var n=a[t];n&&(n.group=e[t])}};e.refreshGroupNames=function(e){e&&(f(e.sites,g_sites),f(e.notes,g_securenotes),f(e.applications,g_applications))},e.useDialogWindows=function(){return Preferences.get("htmlindialog")},e.extendSendImproveParams=function(e,a){a()},t={},e.openTabDialog=function(a,n){var r,i,o={createAccountSimple:!0,siteTutorial:!0},s=a+(n?"-"+JSON.stringify(n):""),c=t[s];if(c)c.activate();else{var l={dialogWindow:e.useDialogWindows()&&!(n&&n.virtualKeyboard)},f={url:getchromeurl("tabDialog.html?dialog="+a),loadHandler:function(e){e.getTop().LPTabDialog.openDialog(a,n,l),t[s]=e},closeHandler:function(){delete t[s]},tabId:n&&n.tabId?n.tabId:void 0};if(f.tabId)e.navigateTab(f);else if(l.dialogWindow&&!o[a]){var u=Preferences.get("dialogSizePrefs"),d=u[a];f.features={height:d?d.height:600,width:d?d.width:800,left:d?d.left:0,top:d?d.top:0},f.features.width>window.screen.availWidth&&(f.features.width=window.screen.availWidth,f.features.left=0),f.features.height>window.screen.availHeight&&(f.features.height=window.screen.availHeight,f.features.top=0),f.closeHandler=(r=f.closeHandler,i=function(e){u[a]={height:e.outerHeight,width:e.outerWidth,left:e.screenLeft||e.screenX,top:e.screenTop||e.screenY},Preferences.set("dialogSizePrefs",u),delete t[s]},function(){r.apply(this,arguments),i.apply(this,arguments)}),e.openDialogWindow(f)}else if(o[a])e.openTab(f);else switch(Preferences.get("openpref")){case"tabs":e.openTab(f);break;case"windows":e.openWindow(f);break;case"same":e.openSame(f)}}},e.stringifyFeatures=function(e){var a=[];for(var t in e)a.push(t+"="+e[t]);return a.join(",")},e.doAjax=function(e){LPServer.ajax(e)},e.ajax=function(a){isOffline()?a.error&&a.error(null,null,"offline"):e.doAjax(a)},e.isEdge=function(){return is_edge()},e.copyDataIfEdge=function(a){return e.isEdge()&&void 0!==a?JSON.parse(JSON.stringify(a)):a},e.setUserPreference=(n=e.setUserPreference,function(e,a){n(e,a),g_userprefs_changed[e]=a}),e.setGlobalPreference=(r=e.setGlobalPreference,function(e,a){r(e,a),g_gblprefs_changed[e]=a}),e.writePreferences=function(){lpWriteAllPrefs()},e.closePopovers=function(){},e.activeOverlayTab=void 0,e.showModalOverlay=function(a){"function"==typeof a&&e.getCurrentTabDetails(function(t){t&&t.tabURL&&t.tabURL.indexOf(getchromeurl(""))<0&&(e.activeOverlayTab=t.tabID,a(t.tabID))})},e.removeModalOverlay=function(e){},e.hideYoureAlmostDoneMarketingOverlay=function(e){},i={},o={},s={},c={},l={},a.LPTabs={get:function(e){if(e.interface){var a=[];for(var t in c)c[t].tabDetails.interfaceName===e.interface&&a.push(c[t]);return e.callback&&e.callback(a),a}if(void 0!==e.tabID){var n=c[e.tabID];if(n)return e.callback&&e.callback(n),n;if(e.callback){var r=s[e.tabID];r||(r=s[e.tabID]=[]),r.push(e.callback)}}return null}},e.getUnavailablePreferences=function(){return{clearClipboardSecsVal:!can_clear_clipboard(),openpopoverHk:!1,pollServerVal:g_nopoll,storeLostOTP:"0"===g_prefoverrides.account_recovery,showvault:g_hidevault||g_hideshowvault,homeHk:g_hidevault||g_hideshowvault,saveallHk:g_hidesaedhotkey,searchHk:g_hidesearch,usepopupfill:!g_offer_popupfill,recentUsedCount:g_hiderecentlyusedlistsize,searchNotes:g_hidenotes,idleLogoffVal:!(g_is_win||g_is_mac||g_is_linux),enablenamedpipes:lppassusernamehash||!(g_is_win||g_is_mac||g_is_linux)||is_chrome_portable(),enablenewlogin:!0}},e.getWindowIDs=function(){var e={};for(var a in c)c[a].tabDetails.windowID&&(e[c[a].tabDetails.windowID]=!0);return Object.keys(e)},e.getWindowTabDetails=function(e){var a=[];for(var t in c){var n=c[t];n.tabDetails.windowID===e&&a.push(n.tabDetails)}return a},e.initializeRequestFramework=function(e){var a=null,t=e.tabDetails||{},n=LPMessaging.getNewMessageSourceID(),r=!1,f=e.frameIdentity,u=!1,d=function(a){try{var t=!u;return t?(a.frameID=n,e.sendContentScript(a)):t}catch(e){return!1}},g=function(e){return d({type:"backgroundResponse",data:e})},p=Raven.wrap(function(u){switch(u.type){case"backgroundRequest":LPMessaging.handleRequest(Interfaces.BackgroundInterface,u.data,g,{additionalArguments:{tabURL:t.tabURL,tabID:t.tabID,windowID:t.windowID,frameID:n,top:r}});break;case"contentScriptRequest":case"contentScriptResponse":if(0===u.frameID)LPMessaging.handleResponse(u.data);else if(u.frameID){var p=i[u.frameID];p&&p(u)}break;case"initialize":!function(s){if(a=c[t.tabID],r=s.top,void 0!==t.tabID&&(r&&(o[t.tabID]=n),s.frameIdentity&&(f=t.tabID+"-"+s.frameIdentity)),d({type:"initialization",data:{tabID:t.tabID,frameID:n,topFrameID:o[t.tabID],request:s}}),s.extendFrame){var u=l[f].frameID,p=i[u];i[u]=function(e){d(e),p(e)}}else i[n]=d;if(s.interfaceName&&Interfaces.hasOwnProperty(s.interfaceName)){t.interfaceName||(t.interfaceName=s.interfaceName);var h=function(e){return LPMessaging.makeRequest(d,{type:"contentScriptRequest",sourceFrameID:0,data:e},g)},D=Interfaces.createInstance(Interfaces[s.interfaceName],{instance:s.extendFrame?l[f].interface:null,direct:!1,context:e.context||"background",requestFunction:h});if(f){var m=l[f];m&&m.frameID!==n&&m.disconnect(),l[f]={interface:D,disconnect:b,frameID:n}}"number"!=typeof t.tabID&&!t.tabID||s.interfaceName!==t.interfaceName||s.extendFrame||(a&&!r||(a&&a.disconnect(),a=c[t.tabID]=new LPTab(t)),a.addFrame(D,{topWindow:r,frameID:n,contentScriptRequester:h,childFrameCount:s.childFrameCount},b)),e.interfaces&&e.interfaces[s.interfaceName]&&e.interfaces[s.interfaceName](D),e.callback&&e.callback(D)}else a||(a=c[t.tabID]=new LPTab(t))}(u.data);break;case"disconnect":b();break;case"initialized":r&&s[t.tabID]&&(s[t.tabID].forEach(function(e){e(a)}),delete s[t.tabID])}}),b=function(){if(!u){u=!0,delete i[n],delete l[f],o[t.tabID]===n&&delete o[t.tabID];var a=c[t.tabID];a&&(a.removeFrame(n),a.isEmpty()&&delete c[t.tabID]),e.onDisconnect&&e.onDisconnect()}};return{frameID:n,requestHandler:p,disconnectHandler:b}}}(LPPlatform,this);
//# sourceMappingURL=sourcemaps/platformBackground.js.map
