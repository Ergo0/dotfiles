LPSiteNotification=function(){var t,e,n,r,i,a,o,u,s,c,l,f,d,p,g=!1,v=!1,m=!1,b=(t=!1,function(e){t||(t=!0,setTimeout(function(){t=!1},0),function(t){for(var e=0;e<t.fields.length;++e)if("password"===t.fields[e].type)return!0;return!1}(e)?(e.generatedPassword||(g=!0),bg.LPTabState.processPasswordSubmit({formData:e,callback:e.generatedPassword||LPContentScriptTools.isUnloading()?null:w})):e.fields.length>0&&(bg.LPTabState.processTextSubmit(e),bg.LPTabState.clear()))}),T=function(t){var e=function(t){for(var e,n=[],r=(t||document.body).querySelectorAll('input:not([type]),input[type="text"],input[type="email"],input[type="password"]'),i=0;i<r.length;++i)(e=r[i]).value&&(e.value!==e.getAttribute("value")||e.value.length>1)&&LPContentScriptTools.isVisible(e)&&n.push(r[i]);return n}(t.form);t.form&&(e=function(t){for(var e=[],n={},r={},i=t.length<1e3?t.length:1e3,a=0;a<i;++a){var o=t[a];switch(o.type){case"hidden":case"text":case"email":!o.value||"hidden"!==o.type&&LPContentScriptTools.isVisible(o)||(n.hasOwnProperty(o.value)?delete r[o.value]:(r[o.value]=o,n[o.value]=!0))}}var u={};return LPContentScriptTools.findTextNodes({searches:Object.keys(r),searchAll:!0,exactMatch:!0,allowEmails:!0}).filter(function(t){return!u.hasOwnProperty(t.match)&&(u[t.match]=!0,!0)}).forEach(function(t){t.parent&&"OPTION"!==t.parent.nodeName&&LPContentScriptTools.isVisible(t.parent)&&e.push(r[t.match])}),e}(t.form).concat(e));for(var n,r,i=[],a=0;a<e.length;++a){var o=e[a],u=(r=void 0,"password"!==(r={type:(n=o).type,value:n.value,id:n.id,label:LPContentScriptTools.getLabel(n),attributes:LPContentScriptTools.getAttributes(n,["name","ng-model","data-reactid"])}).type&&"disc"===LPContentScriptTools.getCSS(n,"text-security")&&(r.type="password"),r);i.push({input:o,inputData:u})}var s=function(t,e){for(var n=[],r=0;r<t.length;++r){var i=t[r];"password"!==i.inputData.type&&(i.inputData.value=E.getUnmaskedValue({input:i.input,inputValue:i.inputData.value,form:e.form})),i.inputData.formname=e.form&&e.form.getAttribute("name")||"",n.push(i.inputData)}return{url:document.location.href,top:window===top,fields:n,generatedPassword:e.generatedPassword,username:E.getUsername()}}(i,t);return t.deferred||b(s),s},h=(e=null,n=function(){e=null},function(t){return function(r){if(e=!1!==r.isTrusted&&!1!==e)try{t(r)}catch(t){Raven.captureException(t)}setTimeout(n,0)}}),S=(i=function(t){if(t.id)return document.getElementById(t.id);for(var e in t.attributes){var n=document.querySelector("input["+e+'="'+t.attributes[e]+'"]');if(n)return n}return null},a=function(t,e){for(var n=0;n<t.fields.length;++n){var r=t.fields[n];if("password"===r.type)return o=t,u=e,void 0,!(!(s=i(a=r))||!LPContentScriptTools.isVisible(s)||(u&&!LPContentScriptTools.isClickable(s)?(v=!0,1):o.passwordChangeForm&&s.value!==a.value))}var a,o,u,s;return!1},r=function(t,e){var n=i(t);n&&n.addEventListener("input",h(function(){e(!0)}))},o=function(t,e){for(var n=0;n<t.fields.length;++n){var i=t.fields[n];"password"===i.type&&r(i,e)}},function(t,e){var n=0,r=null,i=!1,u=function(t){i||(g=!1,i=!0,clearInterval(r),e(t))};g?(r=setInterval(function(){var e=5==++n,r=a(t,e);r&&!e||u(r)},1e3),o(t,u)):u(a(t))}),w=function(t){LPContentScriptTools.isUnloading()||(Topics.get(Topics.SITE_NOTIFICATION_STATE).publish(t),bg.get("LPContentScriptFeatures").new_save_site&&t.dialogData&&!v&&(csTop.LPSiteNotification.showSiteNotification(t),bg.sendTimingEvent("addSite","pause")))},L=(u=function(t){return(t=t.toLowerCase()).indexOf("submit")>-1||t.indexOf("save")>-1},s=function(t){for(var e=t.attributes,n=0;n<e.length;++n){var r=e[n];if(u(r.name)||u(r.value))return!0}return!1},function(t){if("INPUT"===t.nodeName)return"submit"===t.type||"button"===t.type&&s(t);for(var e=t;e&&0===e.getElementsByTagName("input").length;){if("BUTTON"===e.nodeName)return"submit"===e.type||s(e);if(s(e))return!0;e=e.parentElement}return!1}),P=function(t){switch(t.nodeName){case"TEXTAREA":case"SELECT":return!0;case"INPUT":switch(t.type){case"button":case"submit":return!1;default:return!0}default:return!1}},C=(c=null,l=[],d=function(t){(function(t){for(var e=0;e<t.length;++e){var n=t[e];switch(n.type){case"attributes":if(n.target.getAttribute(n.attributeName)!==n.oldValue)return!0;break;default:return!0}}return!1})(t)&&(l.forEach(function(t){t()}),f())},{reset:f=function(){c&&(c.disconnect(),c=null),l=[]},onChange:function(t){"undefined"!=typeof MutationObserver&&(c||(c=new MutationObserver(d)).observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0}),-1===l.indexOf(t)&&l.push(t),setTimeout(function(){f()},0))}}),y=(p=[],{startTracking:function(t,e){var n=function(r){if(t(r.detail)){window.removeEventListener("lprequeststart",n);var i=function(t){r.detail.requestID===t.detail.requestID&&(window.removeEventListener("lprequestend",i),e(t.detail))};window.addEventListener("lprequestend",i)}};window.addEventListener("lprequeststart",n),p.push(n)},stopTracking:function(){p.forEach(function(t){window.removeEventListener("lprequeststart",t)}),p=[]}}),E=function(){var t=null,e=!1,n=[];Topics.get(Topics.FILLED_GENERATED_PW).subscribe(function(t){i({target:t.element,generatedPassword:t.password})}),Topics.get(Topics.CLEAR_DATA).subscribe(function(t){d()}),Topics.get(Topics.LOGIN).subscribe(function(t){bg.LPTabState.getState(function(t){t.enabled&&f(t)})});var r,i=function(t){return t.form=LPContentScriptTools.getForm(t.target),T(t)},a=function(){g=!1,bg.LPTabState.clear()},o=function(t){var e=t&&t.formData;e&&e.fields.length>0&&(y.stopTracking(),y.startTracking(function(t){if(t&&t.data)for(var n=function(t){try{return decodeURIComponent(t)}catch(t){}return null}(t.data),r=0;r<e.fields.length;++r){var i=e.fields[r].value;if(n&&n.indexOf(i)>-1||t.data.indexOf(i)>-1)return!0}return!1},t.responseHandler))},u=(r=/^2[0-9][0-9]$/,function(t){return r.test(t)}),s=function(t){o({formData:t,responseHandler:function(t){u(t.statusCode)||a()}})},c=function(t){var e=i({target:t,deferred:!0});o({formData:e,responseHandler:function(t){u(t.statusCode)&&b(e)}})},l={submit:h(function(t){C.reset(),s(T({form:LPContentScriptTools.getForm(t.target),type:t.type}))}),lpsubmit:function(t){C.reset(),T({form:t.target,type:"submit"})},mouseup:h(function(t){var e=t.target;L(e)?(C.reset(),s(i({target:e,type:t.type}))):P(e)||(g&&C.onChange(a),c(e))}),keydown:h(function(t){if(13===(t.keyCode||t.which)){var e=t.target;P(e)||L(e)?(C.reset(),s(i({target:e,type:t.type}))):(g&&C.onChange(a),c(e))}}),change:h(function(t){var e=t.target;if("INPUT"===e.nodeName&&e.value)switch(e.type){case"text":case"email":for(var r=0;r<n.length;++r)if(n[r].input===e)return void(n[r].value=e.value);n.push({input:e,value:e.value})}}),paste:h(function(t){var e=t.target;P(t.target)&&bg.LPTabState.getCopiedGeneratedPassword(function(t){e.value===t&&i({target:e,generatedPassword:t})})})},f=function(n){if(t=n,!e){for(var r in l)document.addEventListener(r,l[r],!0);e=!0}},d=function(){if(e){for(var t in l)document.removeEventListener(t,l[t],!0);e=!1}n=[]},p=function(t){return t.indexOf("*")>-1||t.indexOf(String.fromCharCode(8226))>-1};return function(){var t=document.documentElement;if(t&&"HTML"===t.nodeName)if(g_ischrome||g_issafari_appext){var e=document.createElement("script");e.appendChild(document.createTextNode(LPContentScriptConstants.JS.PageWebRequestEvents)),t.appendChild(e),t.removeChild(e)}else Topics.get(Topics.INITIALIZED).subscribe(function(){var e=bg.get("extensionBaseURL");if(e){var n=document.createElement("script");n.src=e+"pageWebRequestEvents.js",t.appendChild(n),t.removeChild(n)}})}(),{setup:f,teardown:d,getUnmaskedValue:function(t){if(p(t.inputValue)){var e;for(e=0;e<n.length;++e){var r=n[e];if(r.input===t.input&&r.value!==t.inputValue)return r.value}if(t.form)for(e=0;e<t.form.length;++e){var i=t.form[e];if(a=i,o=t.inputValue,a.value&&!p(a.value)&&a.value.length===o.length&&(a.value[0]===o[0]||a.value[a.value.length-1]===o[o.length-1]))return i.value}}var a,o;return t.inputValue},getUsername:function(){if(t.usernames&&t.usernames.length>0)return LPContentScriptTools.findText({searches:t.usernames,wordMatch:!0})}}}(),N=LPContentScriptTools.debounce(function(){bg.LPTabState.getSiteNotification({callback:w})},1e3,!0);return Topics.get(Topics.INITIALIZED).subscribe(function(){bg.get("LPContentScriptFeatures").new_save_site&&bg.sendTimingEvent("addSite","start"),bg.LPTabState.getState(function(t){t.enabled&&(E.setup(t),window===top?N():t.formSubmittedFrame&&csTop.LPSiteNotification.getSiteNotification())})}),window!==top&&window.addEventListener("beforeunload",function(){g&&csTop.LPSiteNotification.getSiteNotification()},!0),{formExists:S,showSiteNotification:function(t){if(!m){if(m=!0,t.postSetup=function(){Topics.get(Topics.SITE_NOTIFICATION).publish(e)},bg.get("LPContentScriptFeatures").angularFrontendEnabled)var e=LPFrame.openAngularDialog("save-new",t,{css:{top:0,right:0}});else e=LPFrame.openDialog("contentScriptSite",t,{css:{top:10,right:10}});e.onClose(function(){m=!1})}},getSiteNotification:N}}();
//# sourceMappingURL=sourcemaps/addSiteNotification.js.map
